# Операционные системы
### #3 Подсистема управления процессами в операционной системе
# #3 Подсистема управления процессами в операционной системе
# Уточним терминологию
- Термин «программа» - не может использоваться для описания происходящего внутри ОС
- Термин «задание» - не может использоваться для описания происходящего внутри ОС

Данные термины мы можем использовать только для описания статических объектов. А вот в случае описания динамических объектов будем использовать

- Данные термины мы можем использовать только для описания статических объектов. А вот в случае описания динамических объектов будем использовать

# Уточним терминологию
Термин процесс характеризует совокупность 
- набора исполняющихся команд
- набора исполняющихся команд
- текущего момента его выполнения
    - и находящуюся под управлением ОС

Процесс ≠ программа, которая исполняется:
- Для исполнения одной программы может организовываться несколько процессов.
- В рамках одного процесса может исполняться несколько программ.
- В рамках процесса может исполняться код, отсутствующий в программе.

![image](https://iili.io/f9Zg6FV.md.jpg)

# СОСТОЯНИЯ ПРОЦЕССА
Процесс может выполняться, либо не выполняться. Либо может возникнуть ошибка, а может он собирает данные

![image](https://iili.io/f9Zswcx.md.jpg)

# СОСТОЯНИЯ ПРОЦЕССА
Сами состояния процесса могут варьироваться в зависимости от конкретной ОС, но в основном придерживаются представленной концепции.

![image](https://iili.io/f9Zbbx2.md.jpg)

# ОПЕРАЦИИ НАД ПРОЦЕССАМИ
### Рассмотрим набор выполняемых операций над процессами.
- создание процесса – завершение процесса (одноразовые)
- запуск процесса – приостановка процесса (многоразовые)
- блокирование процесса – разблокирование процесса (многоразовые)
- (изменение приоритета)
# ОПЕРАЦИИ НАД ПРОЦЕССАМИ
### Process Control Block (PCB) и контекст процесса.
**Регистровый контекст**
- программный счётчик
- содержимое регистров
**Системный контекст**
- состояние процесса
- данные для планирования использования процессора и управления памятью
- учётная информация
- сведения об устройствах I/O,связанных с процессом.
**Пользовательский контекст**
- Код и данные в адресном пространстве

![image](https://iili.io/f9tCUxt.jpg)

# ОПЕРАЦИИ НАД ПРОЦЕССАМИ
### Как происходит создание процесса
- Порождение нового РСВ с состоянием процесса «рождение»
- Присвоение идентификационного номера
- Выделение ресурсов
    - Из ресурсов родителя
    - Из ресурсов ОС
- Занесение в адресное пространство кода и установка значения программного счётчика
    - дубликат родителя
    - из файла
- Окончание заполнения РСВ
- Изменение состояния процесса на «готовность»
# ОПЕРАЦИИ НАД ПРОЦЕССАМИ
### Как происходит завершение процесса
- Изменение состояния процесса на «закончил исполнение»
- Освобождение ресурсов
- Очистка соответствующих элементов в РСВ
- Сохранение в РСВ информации о причинах завершения

![image](https://iili.io/f9tYEen.jpg)

# ОПЕРАЦИИ НАД ПРОЦЕССАМИ
### Что происходит с процессом после «убийства» родителя
- В ОС VAX/VMS от фирмы DEC при окончании работы родителя, убиваются все потомки программы.
- В Windows и Linux всё более гуманно – потомкам позволяют жить, однако тут есть определённая специфика их работы. 
- При завершении родительского процесса, потомок усыновляется «дедом». 

![image](https://iili.io/f9t15cQ.jpg)

# ОПЕРАЦИИ НАД ПРОЦЕССАМИ
### Как происходит запуск процесса
- Выбор одного из процессов, находящихся в состоянии «готовность»
- Изменение состояния выбранного процесса на «исполнение»
- Обеспечение наличия в оперативной памяти информации, необходимой для его выполнения.
- Восстановление значения регистров.
- Передача управления по адресу , на который указывает программный счётчик
# ОПЕРАЦИИ НАД ПРОЦЕССАМИ
### Как происходит приостановка процесса
- Автоматическое сохранение программного счётчика и части регистров (работа hardware)
- Передача управления по специальному адресу (работа hardware)
- Сохранение динамической части регистрового и системного контекстов в РСВ.
- Обработка прерывания.
- Изменение состояния процесса на «готовность».
# ОПЕРАЦИИ НАД ПРОЦЕССАМИ
### Как происходит блокирование процесса
- Сохранение контекста процесса в РСВ.
- Обработка системного вызова
- Перевод процесса в состояние «ожидание»

![image](https://iili.io/f9tNZva.md.jpg)

# ОПЕРАЦИИ НАД ПРОЦЕССАМИ
### Как происходит разблокирование процесса
- Уточнение того, какое именно событие произошло
- Проверка наличия процесса, ожидающего этого события
- Перевод ожидающего процесса 
- Обработка произошедшего события.

![image](https://iili.io/f9tSbun.jpg)

# Кооперация процессов и основные аспекты её логической организации
# КООПЕРАЦИЯ ПРОЦЕССОВ
### Основные причины объединения усилий
- Повышение скорости решения задач.
- Совместное использование данных.
- Модульная конструкция какой-либо системы.
- Для удобства работы пользователя.

*Кооперативные или взаимодействующие процессы – это процессы, которые влияют на поведение друг друга путём обмена информацией*

![image](https://iili.io/f9tsCJ4.md.jpg)

# КООПЕРАЦИЯ ПРОЦЕССОВ
### Категории средств взаимодействия
- **Сигнальные** – 0 или 1
- **Канальные** – передача через каналы связи.
- **Разделяемая память** – максимальное влияние одного процесса на другой. Самая быстрая, но и самая опасная, поскольку влияние процессов друг на друга максимально.
# Основные аспекты логической организации передачи информации
### Как устанавливается связь.
- Нужна или не нужна инициализация.
- Способы адресации
    - Прямая адресация (оба знают с кем общаются)
- симметричная
- асимметричная 
    - Непрямая или косвенная адресация (доска объявлений)
# Основные аспекты логической организации передачи информации
### Информационная валентность процессов и средств связи
- Сколько процессов может быть ассоциировано с конкретным средством связи?
- Сколько идентичных средств связи может быть задействовано между двумя процессами?
- Направленность связи:
    - Симплексная связь (однонаправленная)
    - Полудуплексная связь (коммутация между направлениями)
    - Дуплексная связь
# Основные аспекты логической организации передачи информации
### Особенности канальных средств связи. Буферизация.
- Буфера не (нулевая ёмкость)
    - процесс-передатчик всегда будет ждать приёма
- Буфер конечной ёмкости
    - процесс-передатчик обязан ждать освобождения места в буфере, если буфер заполнен
- Буфер неограниченной ёмкости (нереализуемо!)
    - Процесс-передатчик никогда не ждёт.
# Основные аспекты логической организации передачи информации
### Особенности канальных средств связи.Модели передачи данных.
- Потоковая модель
    - операции приёма/передачи не интересуются содержимым данных и их происхождением, данные не структурируются
- Модель сообщений
    - на передаваемые данные накладывается определённая структура

![image](https://iili.io/f9Df3Lg.md.jpg)

# Основные аспекты логической организации передачи информации

**Особенности канальных средств связи. Потоковая модель – pipe**

В «трубу «поступает информация от одних процессов, а на выходе из «трубы» процессы информацию получают. Реализуется легко, но через него могут общаться только родственные процессы. Нет подписи данных.

![image](https://iili.io/f9DnRN2.md.jpg)

# Основные аспекты логической организации передачи информации
**Особенности канальных средств связи. Модель сообщений**

Появляется структура, у каждого сообщения есть метаданные, т.е. известно, какой процесс прислал информацию, когда и какую.

![image](https://iili.io/f9DIUrX.md.jpg)

# Основные аспекты логической организации передачи информации
### Надёжность средств связи
- Средство связи считается надёжным если:
    - Нет потери информации
    - Нет повреждения информации
    - Нет нарушения порядка поступления информации
    - Не появляется лишняя информация
# Основные аспекты логической организации передачи информации
### Как завершается связь
- Нужны ли специальные действия для прекращения использования средства связи?
- Как влияет прекращение использования средства связи одним процессом на поведение других участников взаимодействия.

![image](https://iili.io/f9DY3ZJ.jpg)

# Алгоритмы и механизмы синхронизации
# Активности и атомарные операции
### Определение и пример
- **Активность** – последовательное выполнение ряда действий, направленных на достижение определённой цели.
- Активность: приготовление бутерброда:
    - Отрезать ломтик хлеба
    - Отрезать ломтик колбасы
    - Намазать хлеб маслом
    - Положить колбасу на хлеб
- Операции должны быть атомарными и неделимыми.

![image](https://iili.io/f9D16vV.jpg)

# Активности и атомарные операции
### Детерминированность набора
- **Недетерминированный набор** – при одинаковых начальных данных возможны разные результаты.
- **Детерминированный набор** – при одинаковых начальных данных всегда один результат.

![image](https://iili.io/f9DVmxI.jpg)

# Алгоритмы синхронизации
### Суть проблемы
- В случае недетерминированного набора активностей может возникнуть непредсказуемые результаты исполнения. 
- Поэтому могут быть использованы специальные алгоритмы синхронизации, чтобы не возникло состояние race condition (состояние гонки) — ошибка проектирования многопоточной системы или приложения, при которой работа системы или приложения зависит от того, в каком порядке выполняются части кода. 
- Суть проблемы: несколько потоков (или процессов) одновременно пытаются выполнить операции чтения или записи к общим ресурсам без должной синхронизации.
# Алгоритмы синхронизации
### Требования к программным алгоритмам
- **Программный алгоритм должен быть программным**: при написании программ мы не должны использовать специальные команды для обеспечения синхронизации процессов на уровне разделения времени
- **Нет предположений об относительных скоростях выполнения и числе процессоров**: не должно быть предположений о том, что какой-то процесс выполняется быстрее.
- **Выполняется условие взаимоисключения для критических участков**:  каждый такой участок должен выполняться как единое целое.
- **Выполняется условие прогресса**: решение о входе в критическую секцию принимается процессами, которые готовы войти и это решение не должно приниматься бесконечно долго.
- **Выполняется условие ограниченное ожидания.**
# Алгоритмы синхронизации
### Какие есть алгоритмы?
- Программные – запрет прерываний (только на уровне ядра ОС!)
- Классические
    - Программные – «переменная-замок»
    - Программные – «строгое чередование». 
    - Программные – «флаги готовности»
- Модернизированный для одноядерного процессора и 2-х процессов
    - Программные – алгоритм Петерсона

![image](https://iili.io/f9DgJQs.md.jpg)
    
# Алгоритмы синхронизации
### Программные – Bakery algorithm 
- Аналог – талончик в поликлинике.
- Основные идеи:
    - Процессы можно сравнивать по именам.
    - Перед входом в критическую секцию процессы получают талончик с номером.
    - Первым в критическую секцию входит процесс с наименьшим номером на талончике.
    - Выписывание талончика неатомарная операция. Могут быть талончики с одинаковыми номерами.
    - При совпадении номеров на талончиках первым входит процесс с наименьшим значением имени процесса.
# Аппаратная поддержка
### Какие есть алгоритмы с использованием hardware-поддержки?
- Команда `Test-And-Set.` Проверить значение переменной и установить её значение атомарно
```python
int Test_And_Set (int*a) {
  int tmp = *a;
  *a = 1;
  return tmp;
}
```
- Команда `Swap`. Атомарно поменять местами значение двух переменных.
```python 
void Swap (int *a, int *b) {
    int tmp = *a;
    *a = *b;
    *b = tmp;
}
```
# Механизмы синхронизации
### Какая может быть реализация синхронизации процессов?
- **Проблема Producer-Consumer**: один создаёт информацию, другой принимает. Общение предполагается через буфер.
- **Семафоры Дейкстры**: используется целая разделяемая переменная с неотрицательным значением, при равенстве 0 – процесс блокируется. Требует большой концентрации и используется в системном программировании.
- **Мониторы Хора**: конструкции, которые предполагают использование структур, в которых описываются внутренние переменные, которые изменяются с помощью методов.
- **Очереди сообщений**: используется буфер, в который складываются сообщения, затем.
# Механизмы синхронизации
### Какая может быть реализация синхронизации процессов?
- **Очереди сообщений:** используется буфер, в который складываются сообщения, затем оттуда извлекаются. Примитивы для обмена информацией:
- Для передачи данных:
```python 
void send (address, message);
```
- Для приёма данных
```python
void receive(address, message);
```
- Общение по принципу FIFO (First Input – First Output)
- Обеспечивают взаимоисключения при работе с буфером.
# Планирование процессов
### Уровни планирования
- **Долгосрочное планирование** – планирование заданий
- **Среднесрочное планирование** – `swapping`: принятие решения о подкачке данных в оперативную память из долгосрочной и наоборот.
- **Краткосрочное планирование** – планирование использования процессора.

![image](https://iili.io/f9buaBp.jpg)

# Планирование процессов
### Цели планирования
- **Справедливость**: всем процессам должно уделяться процессорное время.
- **Эффективность:**  процессор должен быть загружен на 80%.
- **Сокращение полного времени выполнения (turnaroid time)**: время от «рождения» до его полного окончания.
- **Сокращение времени ожидания (waiting time)**
- **Сокращение времени отклика (response time)**: от момента «нажатия клавиши» до «появления буквы»
# Планирование процессов
### Желаемые свойства алгоритмов
- **Предсказуемость:** время выполнения операций должна быть примерно одинаковой.
- **Минимизация накладных расходов**
- **Равномерность загрузки вычислительных системы:** все ресурсы должны быть полностью загружены.
- **Масштабируемость:** при увеличении нагрузки производительность не должна резко падать.

![image](https://iili.io/f9bcxou.jpg)

# Планирование процессов
### Параметры планирования
- **Статические**
- Статические параметры вычислительной системы – например, предельные значения её ресурсов.
- Статические параметры процесса – кем запущен, степень важности, запрошенное процессорное время, какие требуются ресурсы и т.д.
- **Динамические**
- Динамические параметры вычислительной системы – например, количество свободных ресурсов в данный момент.
- Динамические параметры процесса – текущий приоритет, размер занимаемой оперативной памяти, использованное процессорное время и т.д.
# Планирование процессов
### Важные динамические параметры процесса
```python
// CPU burst
int a, b, c;
a = 1;
b = 2;
std::cin >> c;
// ожидание ввода - I/O burst
// CPU burst
a = a + c * b;
std::cout << a;
// ожидание вывода - I/O burst
```

![image](https://iili.io/f9bXFln.jpg)

# Планирование процессов
### Вытесняющие и невытесняющие
- **Вынужденное принятие решения**
- Перевод процесса из состояния «исполнение» в состояние «закончил исполнение»
- Перевод процесса из состояния «исполнение» в состояние «ожидание»
- **Принятие только вынужденных решений – вытесняющие планирование**
- **Невынужденное принятие решения**
- Перевод процесса из состояния «исполнение» в состояние «готовность»
- Перевод из состояния «ожидание» в состояние «готовность»
- **Принятие вынужденных и невынужденных решений – вытесняющее планирование.**
# Алгоритмы планирования
### Рассмотрим примеры алгоритмов
- **FCFS (First Come – First Served):** процессы обслуживаются по очереди. Показатели эффективности зависят от порядка исполнения процессов с разной CPU Burst.
- **RR (Round Robin)**: «с англ. круглая карусель» на каждый процесс выделяется определённое время (квант). Если время процесса меньше кванта – процесс высвобождается, иначе по истечению кванта времени процесс переходит в конец очереди.
- **SJF (Shortest Job First)**: выбирается процесс с наименьшей CPU Burst, выполняется, и т.д. (невытесняющий). При появлении процесса с меньшим CPU Burst, чем остаток выполняемого – то вытесняет выполняемый процесс. (вытесняющий)
# Алгоритмы планирования
### Приоритетное планирование
- Каждому процессу процессор выделяется в соответствии с приписанным к нему числовым значением – приоритетом.
- Параметры приоритета бывают:
    - Внешние
    - Внутренние 
- Политика изменения приоритета:
    - Статический приоритет
    - Динамический приоритет

![image](https://iili.io/f9bU28N.md.jpg)

![image](https://iili.io/f9bgEss.md.jpg)

    
    
 





 
 


 


 
 

 



 
 

 

 





 




 
    
    
    
    





  



    
    
    



    
    
     


 

    
    

 
   










 
 


 



    
 

















