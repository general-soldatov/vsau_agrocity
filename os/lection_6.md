# Операционные системы
### #6 Файлы и файловые системы 
# Файлы и файловые системы 
### Основные проблемы изложения темы
- Смешивание понятий различного уровней абстракции(например,логического и физического)для файлов и файловых систем.
- Практическое игнорирование сходства и различия управления коллекцией файлов и управление оперативной памятью в мультипрограммных вычислительных системах.

![image](https://image2url.com/images/1761679380203-d16fb10d-e735-49cf-8566-dd24d5004ffb.jpg)
# Файлы и файловые системы
### Смешивание понятий.Файлы
- Файл как математический объект.
- Файл как абстрактный объект в программировании-логический файл.
- Файл как набор связанной информации.Обычно расположенный во вторичной памяти-физический файл.

![image](https://image2url.com/images/1761680494239-d10ed0af-0c20-4464-9bef-2229fb051dc0.jpg)
# Файлы и файловые системы
### Смешивание понятий.Целые Данные
- **Рассмотрим целое число как математический объект.**
    - Множество допустимых значений от - ∞ до + ∞
    - Мощность множества-счётное множество.
    - Основные операции над целыми данными -сложение,вычитание,умножение, деление.
# Файлы и файловые системы
### Смешивание понятий.Целые данные
- **Целые данные как абстрактные объекты в программировании - логические целые данные**
    - Последовательность битов ограниченного размера,интерпретируемая как некоторая запись целого числа в двоичной системе счисления.
    - Множество допустимых значений:от-2n до 2n-1,где n- количество отведённых битов.
    - Мощность множества-конечное множества.
    - Основные операции над целыми данными-сложение,вычитание,умножение,деление,битовые сдвиги,побитовые операции "&","|","~","^".
# Файлы и файловые системы
**Смешивание понятий.Целые данных**

![image](https://image2url.com/images/1761683494009-bedcc44a-e5c6-4b29-acf3-72887bbfc599.jpg)

**Целые данные как физические данные в памяти вычислительной системы.**
Рассмотрим произвольное число и разместим его в в физических ячейках памяти.Способ размещения числа `Big endian`,когда старшие биты имеют младшие адреса.А когда старшие биты распологаются в старших адресах-`Little endian`.

В результате переноса данных с одной архитектуры на другую,смысл данных может меняться.
# Файлы и файловые системы
### Файл как математический объект
- **Файл**-это упорядоченный набор информации в цифровом виде,у которого есть начало и конец,снабжённый указателем текущей позиции, конце или между элементами набора.
- Надо файлом допустимы следующие операции:
   - Чтение(Read) 
``` python
with open (`data.txt`,`rb`) as ("data"):
 elems= data.read(2)
 print("elems")
 ```
    - Запись (write)
``` python
with open (`data.txt`, `wb`) as ("data")
  bits = int("0xFF12", 16). to_bytes(4, "big")
  elems = data.write (bits)
  print(bits)
```
# Файлы и файловые системы
### Файл как математический объект
- Надо файлом допустимы следуюшие операции:
    - Усечение (truncate)
``` python 
with open(`data.txt, `rb+`) as data :
   `data.trun.cate`(3)
   elem = data.read(4)
   print(elem)
```
- Лирическое отступление:рассмотрим файлы бывают:
    -  Последовательного доступа:когда мы биты можем считать только по очереди,и для чтения начальных битов-использовать перемотку(rewind).
    - Прямого доступа:указатель по файлу можно перемещать независимо
```python
with open (`data.txt`,`rb`) as data:
   data.seek(1)
   elem = data.read(4)
   print(elem)
```
# Файлы и файловые системы
### Файл как математический объект
![image](https://image2url.com/images/1761686318576-6e55bd33-17c6-4ab3-a212-978dbfda0508.jpg)

**Структурирование информации.Записи.**

В файле записи могут быть фиксированной длинны,когда информация разбита на отдельные блоки,которые и есть запись.Либо переменной длины,когда блоки не имеют фиксированного размера.

Т.е запись-это структурная единица и мы не можем считать или изменить запись частично.

Поэтому в этом случае указатель текущей позиции может быть установлен на начало файла,на конец файла,на границу между записями.
# Файлы и файловые системы
### Файл как математический объект
- **Структурирование информации.Записи.Операции над файлами**
    - `read recond`/прочитать запись
    - `add record`/добавить записи
    - `delete record`/удалить записи
    - При последовательном доступе
    - [ ] Перемотка("rewind")
    - При прямом доступе:
    - [ ] Поиск записи ("seek record")
# Файлы и файловые системы
### Логический файл-файл в программе
- Файл может храниться на диске или на другом внешнем носителе информации и не прекращать существования после завершения процесса или завершения работы OC.
- Существуют ограничения на размере файла.
- Минимальной единицей информации для операции чтения и записи является байт.
- Файл может быть использован различными процессами,возможно,различных пользователей,иногда совместно.
# Файлы и файловые системы
### Логический файл
- Размещение файла во вторичной памяти требует добавления операции,("create file")и("delete file")
``` python
    open(`data.txt`,`rb`)
    os.remove(`data.txt`)
```
- Файл может хранить долго.Появляются атрибуты,содержащие времена создания,модификации,последнего обращения к файлу.
- Файл может храниться долго.Появляются атрибуты,содержащие индентификатор хозяина файла и права доступа к файлу.
# Файлы и файловые системы
### Логический файл
- Наличие атрибутов требует операций ("get attributes")/("put attribules")
    - `os.stat`(`data.txt`)#Windows
    - Для Linux:
    - `os.getxattr`(`plain.txt`,`user.bar`,b`baz`)
    -`os.getxattr`(`plain.txt`,`user.bar`)
- Появляются операции для безопасного совместного использования файлов.
# Файлы и файловые системы
### Логический файл
- **Также для структурировынных файлов возникает проблема,куда переместить курсор?Где начинается запись,где кончается?**
    - Для последовательных файлов перед каждой записью выделяется область,где записана длина.
    - Для файлов прямого доступа используется таблица индексов,в которой указывается и длина записи и offset для конкретной  записи от начала файла.
# Файлы и файловые системы
### Физически файл
- Поскольку в современных вычислительных системах обычно на внешних носителях хранится не единиственный файл,а некоторый набор(или коллекция) файлов,то рассмотрение организации хранения физического файла естественно отнести к рассмотрению физической организации хранения коллекции файлов или к рассмотрению понятия физической файловой системы.

![image](https://image2url.com/images/1761690212850-f605f64e-592d-4fe0-a464-28f55e9fc76a.jpg)
# Файлы и файловые системы
### *Смешивание понятий.Файловая система.*
- Файловая система как способ организации коллекции логических файлов-логическая файловая система.
- Файловая система как структурированная совокупность файлов,расположенных во вторичной памяти-физическая файловая система.
- Файловая система как часть OC-программые средства,обслуживающие физическую файловую систему.
# Файлы и файловые системы
### Логическая файловая система
- **Способы организации**:
    - **Куча(одноуровневая директория)**-при переходе от отдельного логического файла к коллекции логических файлов файлы требуется именовать.Имена файлов в этом случае удобно хранить имена файлов в виде списка и логично такой список назвать **папкой**или **директорией**.
    - Директория- это отдельная структура данных,состоящая из записей.Каждая запись содержит имя файла и информацию о том,как добраться до его атрибутов и данных.
    - Такая организация удобна,когда файлов мало и один пользователь.Это стркуктура требует постоянного хранения.В логической файловой системе появляются 2 различных типа файлов:директории и все остальные -регулярные файлы.
# Файлы и файловые системы
### Логическая файловая система
- **Способы организации**:
    - **Двухуровневая директория**- в этом случае у нас есть главная директория `Master files`,в которой лежат директории отдельных пользователей,у каждого из которых есть своя"куча",организованная в виде одноуровневой директории `User files directory`.
    - В этом случае у каждого пользователя могут быть одинаковые файлы,что может быть вполне нормально.
    - Но такой подход можно интерполировать и на многоуровневую организацию файловой системы.
# Файлы и файловые системы
### Логическая файловая система
- **Способы организации**:
    - **Многоуровневая директория(дерево директорий)**-в этом случае у нас есть главная директория,называемая корневой,в которой могут находиться поддиректории или даже отдельные файлы.В каждой из поддиректорий может быть также своя поддиректория со своими файлами и поддиректориями.
    - В этом случае приходят такие понятия как полный и относительный имена файлов.Полный путь строится начиная от корневой директории.
# Файлы и файловые системы
### Логическая файловая система
- **Способы организации**:
    - Для UNIX-подобных систем корневая директория и разделители обозначаются"/".То есть полное имя будет:/usr/test_user/count
    - Для Windows систем корневая директория начинается с диска:C\usr\test_user\count
    - Однако из-за большого уровня вложенности могут возникнуть ошибки при доступе к файлам.
    - Относительное имя файла начинается с текущей директории.И при пути наверх мы будем начинать путь следующим образом:./../usr/test_user/count
    - При нахождении файла в текущей директории мы можем обратиться к нему так:`count`
# Файлы и файловые системы 
- **Способы организации:**
    - **Многоуровневая директория (дерево директорий)**
    - Также у нас изменяются подходы "cоздания"и"удаления"файла.В этом случае нам необходимо указать путь до файла,а также внести/ликвидировать информацию в соответсвующую директорию.
    - Также появлятся операция "создать директорию"
  
![image](https://image2url.com/images/1761758868755-2296506f-f0b0-4ea1-a7c5-ae780525ab01.jpg)
# Файлы и файловые системы 
### Логическая файловая система
- **Способы организации**:
    - **Акциклический граф**
    - При многопользовательской организации появляется операция "создать желтую связь"между файлами.
    - Изменяется операция "удаление файлами",поскольку есть жёсткая связь.В этом случае мы можем только удалить запись в каталоге, а сам файл остаётся.А физически файл удалится только тогда,когда количество связей станет равно 0.
    - **Граф общей стркуктуры**
    - В этом случае в атрибутах директории указывается возможность доступа к файлу и установить способ добраться до требуемого файла.
# Файлы и файловые системы
### Логическая файловая система 
- **Способы организации:**
- **Граф общей структуры**
    - Однако в утилитах может возникуть зацикливание.Для его исключения ставиться пометка,что эта ссылка,а не файл.То есть добавляется операция "cоздать символическую связь".
    - То есть OC теперь мы знаем три типа файлов:
    - [ ] `Директории`
    - [ ] `Регулярные`
    - [ ] `связь`
# Файлы и файловые системы
### Логическая файловая система
- **Монтирование файловых систем**
    - В этом случае одной из директорий корневого каталога создаётся точка монтирования для корневой директории 2 и тогда из корневого каталога мы можем добраться до корневой директории 2 другой файловой системы через эту точку монтирования.
    - Смонтированные файловые системы всегда можно размнонтировать обратно.
# Файлы и файловые системы
### Физические файлы и файловая система
- **Понятие о File Control Block**
- Для корректной работы с файлом необходимо иметь информацию о:
    - Атрибутах файла:тип файла(директория или регулярный файл),времена создания,модификации,последнего обращения к файлу,кто является хозяином файла,какие права доступа имеют к файлу другие пользователи,размер файла и.т.д
    - Расположении файла не внешнем носителе информации.
- Эти данные мы будем считать хранящимися в блоке управления файлом `File Control Block-FCB`.
# Файлы и файловые системы
### Физические файлы и файловая система
- **Понятие о File Control Block**
- Где может храниться FCB:
    - В записи директории,содержащей имя файла.
    - Частично в директории,а частично совместно с файлом.
    - Частично в директории,а частично в отдельной структуре.
    - Отдельно от директории и от файла.
- **Способ хранения определяется реализацией физической файловой системы.**
# Файлы и файловые системы
### Физические файлы и файловая систем
- **Организация вторичной памяти**
    - По физическим причинам обмен информацией со вторичной памятью не может осуществяться побайтно.
    - Единицей обмен данными служит сектор или страница,содержие большое количество байт.
    - Часть секторов с известными расположением (обычно в начале вторичной памяти)отводиться под заголовок физической файловой системы.
# Файлы и файловые системы
### Физические файлы и файловая система
- **Организация вторичной памяти**
- Оставшиеся сектор объединяется в логические блоки,имеющие последовательную нумерацию.
    - В заголовке хранится:тип файловой системы,размер заголовка,количество логических блоков в файловой системе,размер блока в байтах,файловой системе,размер блока в байтах,начальный блок корневой директории и др.
    - Информация,содержащаяся в файлах хранится в логических блоках вторичной памяти.
    - Логические блоки могут использоваться и для хранения информации о FCB.

![image](https://image2url.com/images/1761762801183-b0f27c8a-a5d5-4d5e-b049-7ff69b5cd734.jpg)
# Файлы и файловые системы
### Физичесие файлы и файловая система
- **Методы выделения блоков.Неприрывное выделение.**
   - Свойтва
- [ ] В этом случае FCB хранится в директории,содержащей имя файла.
- [ ] Всем методам выделения блоков присуща внутренняя информация.
- [ ] При непрерывном выделении блоков чтение информации из файла происходит очень быстро.
   - Недостатки
- [ ] Проблемы с размещением файла при увеличении его размеров.
- [ ] Непрерывному выделению свойственна внешняя фрагментация.
    - Часто применятся при создании `read-only`систем.
# Файлы и файловые системы
### Физические файлы и файловая система
- **Методы выделения блоков.Связный список**.
- **Свойства**
- [ ] В этом случае FCB частично храниться в директории,частично совместно с файлом.
- [ ] Для такого способа в блоке выделяется часть под ссылку на следущий блок,либо информация об оканчании файла.
- [ ] Метод свободен от внешней фрагментации.
    - Недостатки
- [ ] Использование связного списка по сути прямой доступ к файлу к последовательному доступу.
- [ ] Дополнительные потери дичковой информации из-за хранения указателей в блоках.
- [ ] Ненадёжность хранения информации.
# Файлы и файловые системы
### Физические файлы и файловая система.
- **Метод выделения блоков.FAT **File Allocation Table**.
    - Свойства 
- [ ] В этом случае таблица FAT хранится в заголовке памяти,например,FAT 16-под каждый элемент списка выделяется 16 бит.Количество элементов соответвествует количеству блоков.
- [ ] В директории хранится информация и ссылка на блок хранения файла физической памяти и на соотвествующий элемент FAT.
- [ ] FCB хранится частично в директории,а частично-в отдельной структуре.
- [ ] Метод свободен от внешней фрагментации.

![image](https://image2url.com/images/1761767215471-fd2e4fbb-bf7a-4a4b-9d1d-a2043391b877.jpg)
# Файлы и файловые системы
### Физические файлы и файловая система.
-**Метод выделения блоков.FAT(File Allocation Table).**
   - Свойства 
   - [ ] Возможность загрузить FAT целиком в RAM позволяет осуществлять быстрый прямой доступ к нужным данным.
   - [ ] Для повышения надёжности хранится несколько копий FAT.
   - [ ] Не имеет прямых аналогов в схемах управления оперативной памятью.

![image](https://image2url.com/images/1761767215471-fd2e4fbb-bf7a-4a4b-9d1d-a2043391b877.jpg)
# Файлы и файловые системы
### Физические файлы и файловая система
- **Метод выделения блоков.Прямая индексация.**
- [ ] В схемах управления RAM аналогом является страничная память.
- [ ] Для каждого файла создаётся таблица соотвествия порядка размещения файла на диске.
- [ ] В директории хранится ссылку на таблицу индексов,а сам таблица-в одной из блоков.
- [ ] Также в эту таблицу можно разместить  размер файла и др.атрибуты->индексный узел.Одного в этом случае индексный узел может иметь переменный размер.
- [ ] Решить проблему может помочь многоуровневая индексация.
# Файлы и файловые системы
### Физические файлы и файловая система.
- **Методы выделения блоков.Смешанная индексация.**
- [ ] В этом случае в индексном узле находится атрибуты файла и ссылки на блоки,а если файл большой,то хранится адрес блока косвенной адресации.
- [ ] Также может быть реализовано хранение адрес блока двойной косвенной индексации.
- [ ] А если недостаточно-тройной.
# Файлы и файловые системы
### Файлы систем как часть OC
- Файловая система как часть ОС-это программные средства,обслуживающие физическую файловую систему.
- Функции:
    - Распределение внешней памяти между файлами.Учёт занятого и свободного пространства внешней памяти.
    - Идентификация файлов.Связывание имени файла с его расположением на внешнем устройстве.
    - Обеспечение выполнение операций над файлами и логическими файловыми системами.
    - Защита от несанкционированного доступа.
    - Предоставление возможности совместного использования файлов.
    - Обеспечение надёжности и отказоустойчивости.
# Файлы и файловые системы 
### Функции файловой подсистемы ОС
- Распределение внешней памяти между файлами.Учёт занятого и свободного пространства внешней памяти.
    - Файловая подсистема ОС осуществляет первоначальную разметку внешнего носителя информации-формирование диска.
    - Файловая подсистема ОС при создании или модификации файл осуществляет выделение (при небходимости)свободных логических блоков и модификацию содержимого FCB.
    - Файловая подсистема ОС ведёт учёт свободных логических блоков:
    - [ ] С помощью битового вектора
    - [ ] С помощью связного списка
# Файлы и файловые системы
### Функции файловой подсистемы ОС
- Идентификация файлов.Связывание имени с его расположением на внешнем устройстве.
    - Для связывания имени с его расположением файловая подсистема ОС последовательно разбирает полное или относительное имя файла.Пример./a/b
    - Читаем FCB корневой директории "/"и определяем расположение файла корневой директории на диске.
    - Считываем содержимое корней директории,находим запись,соотвествующию имена"/a",убеждаемся,что это его директория,и определяем расположением этого файла на диске.
    - Считываем содержимое директории"/a",находим запись,соотвествующию имени "b",и читаем FCB файл "/a/b",определяем расположение этого файла на диске.
    - Требуется большое количество обращений к диску.Для повышения эффективности появляются операции `open`и`close`.
![image](https://image2url.com/images/1761770702464-61bec638-936f-43ff-afdf-18b85beeab76.jpg)
